---
title: "Analysis of vitamin C intake against tooth growth"
author: "Sandro Vicente"
date: "Sunday, May 17, 2015"
output: html_document
---

### Overview

to do...

### Obtaining Data

Data is obtained from standard R datasets.

```{r} 
library(datasets)

library(ggplot2) # auxiliry libraries added
library(plyr)

## shows clusters
ggplot(data=ToothGrowth, aes(x=len, y=dose, group=supp, colour=supp)) +
    geom_point() + ggtitle("Figure 1 - Distribution of length per supplement type and dose") 

```

A first exploratory plot (figure 1) shows that lenght tend to increase with the dose. 
OJ supplement seems to have more influence in growth for doses of 0.5mg and 1mg.

We can convert doses and supplement types into factors to perform further analysis.

```{r}
tg <- ToothGrowth
tg$dose <- factor(tg$dose)
tg$supp <- factor(tg$supp)

summary(tg)

table(tg[,c("supp", "dose")])
```
We have the same number of observations for each combination of doses (`r levels(tg$dose)`) and and supplements (`r levels(tg$supp)`).

We can initially explore how the type of supplement alone affects variations in length.

For that, a function is defined to take a number of samples and estimate the mean, standard error and the limits of values for a confidence interval using the Central Limit Theorem.

*Here we assume all samples are IID*
```{r}
calc_interval <- function(x, conf) {
    quantile <- 1-(1-conf)/2
    n <- length(x)
    sdn <- sd(x)/sqrt(n)
    m <- mean(x)
    interval <- (m+c(-1,1)*qnorm(quantile)*sdn)    
    list(quantile=quantile, n=n, sd=sdn, m=m, interval=interval)
} 

confidence <- 0.95 
```

Analysis over different supplement types. 
For all analysis we use the confidence interval of `r confidence`.
```{r}
for (supp in levels(tg$supp)) {
    x <- tg[tg$supp==supp,"len"]
    l <- calc_interval(x, confidence)
    print(sprintf("Supplement: %s, mean: %f, sd: %f, size: %d, range:[%f, %f]", supp, l$m, l$sd, l$n, l$interval[1], l$interval[2]))
}
```
Both invervals overlap, so the supplement type alone is not significat to correspond the length with the given confidence of `r confidence`.

Analysis over different doses
```{r}

data.type <- data.frame()  # dataframe containg data per type (i.e. per dose)
norm.type <- data.frame()  # dataframe containg summarized for normal distribution per type (i.e. per dose)
for (dose in levels(tg$dose)) {
    x <- tg[tg$dose==dose,"len"]
    ds <- data.frame(x=x, type=dose)  
    data.type <- rbind(data.type, ds)
    
    l <- calc_interval(x, confidence)
    norm.type <- rbind(norm.type, data.frame(m=l$m, sd=l$sd, type=dose)) # data for normal distribution of sample
    
    print(sprintf("Dosage: %s mg, mean: %f, sd: %f, size: %d, range:[%f, %f]", dose, l$m, l$sd, l$n, l$interval[1], l$interval[2]))
}

# Calculate normal values for reference 
len.min <- min(tg$len) # minimum length
len.max <- max(tg$len) # maximum legth
len.x <- seq(len.min, len.max, length=100) # range of lengths from min to max 

# function to calculate normal densities given data frame containg "type", "m" mean and "sd" sample's standard deviation
calc_normal <- function(nt) {
    ddply(norm.type, "type", function(df) {
        data.frame( 
            predicted = len.x,
            density = dnorm(len.x, mean=df$m, sd=df$sd)
        )
    })
}

normaldens <- calc_normal(norm.type) # normal densities for the corresponding types

# plot histogram and corresponding normal distributions in separated frames
ggplot(data.type, aes(x=x, fill=type)) +  geom_histogram(alpha = 0.5, aes(y = ..density..), position = 'identity') +
    geom_line(data=normaldens, aes(x = predicted, y=density)) +
    facet_wrap(~ type, ncol=3)

# plot histogram and normal distributions altogether
ggplot(data.type, aes(x=x, fill=type)) +  geom_histogram(alpha = 0.5, aes(y = ..density..), position = 'identity') +
    geom_line(data=normaldens, aes(x=predicted, y=density, color=type)) 

```

Drill down into supplement types and doses
```{r}

data.type <- data.frame()  # reset dataframe containg data per type (i.e. per dose and supp)
norm.type <- data.frame()  # reset dataframe containg summarized for normal distribution per type (i.e. per dose and supp)
for (dose in levels(tg$dose)) {
    for (supp in levels(tg$supp)) {
        x <- tg[tg$supp==supp & tg$dose==dose,"len"]
        l <- calc_interval(x, confidence)
        
        ds <- data.frame(x=x, type=paste(supp,dose,sep="-"))
        data.type <- rbind(data.type, ds)
        norm.type <- rbind(norm.type, data.frame(m=l$m, sd=l$sd, type=paste(supp,dose,sep="-"))) # type defined as composition supp "-" dose

        print(sprintf("Supplement:%s, Dosage: %s mg, mean: %f, sd: %f, size: %d, range:[%f, %f]", supp, dose, l$m, l$sd, l$n, l$interval[1], l$interval[2]))
    }
}

# calculate normal distribution for types based on dose and supp
normaldens <- calc_normal(norm.type)

# plot histogram and corresponding normal distributions in separated frames
ggplot(data.type, aes(x=x, fill=type)) +  geom_histogram(alpha = 0.5, aes(y = ..density..), position = 'identity') +
    geom_line(data=normaldens, aes(x = predicted, y=density)) +
    facet_wrap(~ type, ncol=3)

# plot histogram and corresponding normal distributions althogether
ggplot(data.type, aes(x=x, fill=type)) +  geom_histogram(alpha = 0.5, aes(y = ..density..), position = 'identity') +
    geom_line(data=normaldens, aes(x=predicted, y=density, color=type))
```
